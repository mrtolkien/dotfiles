############################
# P10K START
############################
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi


############################
# OH MY ZSH 
############################
ZSH_THEME="powerlevel10k/powerlevel10k" 

# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh

# Removing auto update
zstyle ':omz:update' mode disabled

# oh-my-zsh plugins
plugins=(
    git
    docker 
    docker-compose
    aws 
    gh 
    poetry 
    ripgrep 
    zsh-syntax-highlighting 
    zsh-autosuggestions 
    zsh-autocomplete
    git-open
)

# Plugin settings
zstyle ':autocomplete:*' min-delay 0.05  # seconds (float)

# zsh-completions have to be loaded a bit differently
fpath+=${ZSH_CUSTOM:-${ZSH:-~/.oh-my-zsh}/custom}/plugins/zsh-completions/src

# Source oh-my-zsh.sh
source $ZSH/oh-my-zsh.sh

############################
# SHELL UTILS
############################

# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Zoxide = z replacement!
eval "$(zoxide init zsh)"

# Atuin shell history
eval "$(atuin init zsh)"

# Make nvim the default CLI editor
export EDITOR="nvim"

############################
# ALIASES
############################
alias dps="docker ps"
alias f="open ."
alias ls="exa"
alias la="exa -la"
alias tree="exa -T"

############################
# LOCAL CONFIGURATION
############################

############################
# Macbook Pro M2
############################
{{- if eq .chezmoi.hostname "Garys-MacBook-Pro" }}
# TODO Make pyenv asynchronous (too costly) / move to other env tool?
# Pyenv
export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# Fixing an error I had with psql
export PATH="/opt/homebrew/opt/postgresql@15/bin:$PATH"
{{- end }}

############################
# P10K END
############################
# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh